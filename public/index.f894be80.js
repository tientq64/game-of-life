m.mount(document.body,class{constructor(){for(let t of(this.width=screen.width,this.height=screen.height,this.groupA=null,this.groupB=null,this.isShowPanel=!0,this.dragging=!1,this.loaded=!1,Object.getOwnPropertyNames(Object.getPrototypeOf(this))))"function"==typeof this[t]&&(this[t]=this[t].bind(this))}oncreate(){let t=this.canvasVnode.dom.transferControlToOffscreen();this.worker=new Worker(new URL("worker.js",location.href)),this.worker.addEventListener("message",this.onmessageWorker),this.send("init",{width:this.width,height:this.height,offscreenCanvas:t},[t]),window.addEventListener("keydown",this.onkeydownGlobal),m.redraw()}send(t,e,o){this.worker.postMessage([t,e],o)}sendProps(...t){let e={};for(let o of t)e[o]=this[o];this.worker.postMessage(["props",e])}sendCall(t,...e){this.worker.postMessage(["call",{name:t,args:e}])}getBgColorByG(t){return t>0?`rgba(0, 128, 0, ${t})`:t<0?`rgba(255, 0, 0, ${-t})`:"#0000"}getTextColorByG(t){return t>0?"#84cc16":t<0?"#fb7185":"#fff"}onmousedownGroupA(t,e){let o=e.shiftKey?10:1;switch(e.button){case 0:this.sendCall("addAtoms",t.color,o);break;case 2:this.sendCall("removeAtoms",t.color,o)}}onmouseenterG(t,e){this.groupA=t,this.groupB=e}onmouseleaveG(){this.groupA=null,this.groupB=null}onmousedownG(t,e,o){let n=o.shiftKey?1:.1,s=this.gMaps[t.color],r=s[e.color];switch(o.button){case 0:case 2:2==o.button&&(n*=-1),this.gMaps[t.color][e.color]=Math.round((r+n)*10)/10,this.sendProps("gMaps");break;case 1:this.gMaps[t.color][e.color]=0,this.sendProps("gMaps")}}onpointerdownCanvas(t){t.target.setPointerCapture(t.pointerId),this.dragging=!0}onpointermoveCanvas(t){this.dragging&&this.sendCall("translate",t.movementX,t.movementY)}onlostpointercaptureCanvas(t){this.dragging=!1}onmessageWorker(t){let[e,o]=t.data;switch(e){case"loaded":Object.assign(this,o),this.loaded=!0;break;case"props":Object.assign(this,o)}m.redraw()}onkeydownGlobal(t){let{ctrlKey:e,shiftKey:o,altKey:n,repeat:s}=t,r=!e&&!o&&!n&&!s;if("Space"==t.code&&r&&t.target.matches("button, input[type=number]")&&(t.preventDefault(),t.target.blur()),document.activeElement===document.body){switch(t.code){case"Space":r&&(this.isShowPanel=!this.isShowPanel);break;case"KeyR":r&&this.sendCall("randomGMaps");break;case"KeyT":r&&this.sendCall("randomAtomsXY");break;case"KeyC":r&&this.sendCall("clearScreen")}m.redraw()}}view(){return m(".flex.justify-end.items-center.h-full",this.loaded&&m(".absolute.left-0.p-3.w-72.h-full.overflow-auto.bg-black.bg-opacity-50.scrollbar-none",{hidden:!this.isShowPanel},m("p","Lực tương t\xe1c:"),m("table.w-full.table-fixed.rounded.overflow-hidden.text-center",m("tr.h-7",m("th.font-normal",m("sub","A"),m("sup","B")),this.groups.map(t=>m("th",{style:{background:t.color}}))),this.groups.map(t=>m("tr.h-7",m("th.justify-center.items-center.text-xs.font-normal.cursor-pointer",{class:"#e2e8f0"==t.color?"text-black":"text-white",style:{background:t.color},onmousedown:this.onmousedownGroupA.bind(this,t)},t.atomsNum),this.groups.map(e=>{let o=this.gMaps[t.color][e.color];return m("td.justify-center.items-center.text-xs.text-white.cursor-pointer",{style:{background:this.getBgColorByG(o)},onmouseenter:this.onmouseenterG.bind(this,t,e),onmouseleave:this.onmouseleaveG,onmousedown:this.onmousedownG.bind(this,t,e)},Math.round(10*o))})))),m(".mt-2.h-6",this.groupA&&m(".flex.items-center.gap-4",m(".flex.items-center",m(".w-6.h-6.border",{style:{background:this.groupA.color}}),m(".w-6.h-6.border.border-l-0",{style:{background:this.groupB.color}}),m(".ml-2.w-6.h-6.flex.justify-center.items-center.text-xs",{style:{background:this.getBgColorByG(this.gMaps[this.groupA.color][this.groupB.color])}},Math.round(10*this.gMaps[this.groupA.color][this.groupB.color]))),m(".flex.items-center",m(".w-6.h-6.border",{style:{background:this.groupB.color}}),m(".w-6.h-6.border.border-l-0",{style:{background:this.groupA.color}}),m(".ml-2.w-6.h-6.flex.justify-center.items-center.text-xs",{style:{background:this.getBgColorByG(this.gMaps[this.groupB.color][this.groupA.color])}},Math.round(10*this.gMaps[this.groupB.color][this.groupA.color]))))),m("p.text-sm.text-gray-400",m("div","Chuột tr\xe1i: Lực + 1"),m("div","Chuột phải: Lực - 1"),m("div","Chuột giữa: Lực = 0"),m("div","Đ\xe8 Shift để tăng/giảm 10 lần"),m("div","Lực < 0, A h\xfat v\xe0o B"),m("div","Lực > 0, A đẩy khỏi B")),m(".mt-1.flex.flex-wrap.gap-2",m("button.px-2.border.border-gray-400.hover:border-gray-200.rounded.bg-gray-600",{onclick:()=>{this.sendCall("randomAtomsXY")}},"Ngẫu nhi\xean vị tr\xed"),m("button.px-2.border.border-gray-400.hover:border-gray-200.rounded.bg-gray-600",{onclick:()=>{this.sendCall("clearScreen")}},"X\xf3a m\xe0n h\xecnh")),m(".mt-2","Khoảng ngẫu nhi\xean khi tạo lực:"),m(".flex.gap-2",m("input.flex-1.min-w-0.px-2.rounded.text-black",{type:"number",max:this.maxRandomG,value:this.minRandomG,title:"Min",oninput:t=>{let e=Number(t.target.value);isNaN(e)||(this.minRandomG=e,this.sendProps("minRandomG"))}}),m("input.flex-1.min-w-0.px-2.rounded.text-black",{type:"number",min:this.minRandomG,value:this.maxRandomG,title:"Max",oninput:t=>{let e=Number(t.target.value);isNaN(e)||(this.maxRandomG=e,this.sendProps("maxRandomG"))}})),m(".mt-2.flex.flex-wrap.gap-2",m("button.px-2.border.border-gray-400.hover:border-gray-200.rounded.bg-gray-600",{onclick:()=>{this.sendCall("randomGMaps")}},"Ngẫu nhi\xean lực"),m("button.px-2.border.border-gray-400.hover:border-gray-200.rounded.bg-gray-600",{onclick:()=>{this.sendCall("resetGMaps")}},"Reset lực")),m(".mt-2","Khoảng c\xe1ch c\xe1c hạt tương t\xe1c:"),m(".flex.gap-2",m("input.flex-1.min-w-0.px-2.rounded.text-black",{type:"number",min:0,max:this.maxDistance,value:this.minDistance,title:"Min",oninput:t=>{let e=Number(t.target.value);isNaN(e)||(this.minDistance=e,this.sendProps("minDistance"))}}),m("input.flex-1.min-w-0.px-2.rounded.text-black",{type:"number",min:this.minDistance,max:1e3,value:this.maxDistance,title:"Max",oninput:t=>{let e=Number(t.target.value);isNaN(e)||(this.maxDistance=e,this.sendProps("maxDistance"))}})),m(".mt-2","B\xe1n k\xednh hạt:"),m("input.flex-1.min-w-0.w-full.px-2.rounded.text-black",{type:"number",min:.5,max:500,step:.5,value:this.radius,oninput:t=>{let e=Number(t.target.value);isNaN(e)||(this.radius=e,this.sendProps("radius"))}}),m(".mt-2","Độ trong suốt hạt:"),m("input.flex-1.min-w-0.w-full.px-2.rounded.text-black",{type:"number",min:.1,max:1,step:.1,value:this.alpha,oninput:t=>{let e=Number(t.target.value);isNaN(e)||(this.alpha=e,this.sendProps("alpha"))}}),m(".mt-2","Hiệu ứng vệt mờ:"),m("input.flex-1.min-w-0.w-full.px-2.rounded.text-black",{type:"number",min:0,max:1,step:.1,value:this.trail,oninput:t=>{let e=Number(t.target.value);isNaN(e)||(this.trail=e,this.sendProps("trail"))}}),m("p.mt-2","Ph\xedm tắt:"),m("p.text-sm.text-gray-400",m("div","Nhấn R để ngẫu nhi\xean lực."),m("div","Nhấn T để ngẫu nhi\xean vị tr\xed."),m("div","Nhấn C để x\xf3a m\xe0n h\xecnh."),m("div","Nhấn Space để bật/tắt bảng điều khiển n\xe0y.")),m("p.mt-2","Mẹo:"),m("p.text-sm.text-gray-400",m("div","Mở to\xe0n m\xe0n h\xecnh để xem được tốt nhất."))),this.canvasVnode=m("canvas.max-w-full.max-h-full",{class:this.dragging?"cursor-grabbing":"cursor-grab",width:this.width,height:this.height,onpointerdown:this.onpointerdownCanvas,onpointermove:this.onpointermoveCanvas,onlostpointercapture:this.onlostpointercaptureCanvas}))}}),window.addEventListener("contextmenu",t=>{t.preventDefault()});